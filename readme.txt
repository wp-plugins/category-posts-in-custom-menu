=== Category Posts in Custom Menu ===
Contributors: anaid
Tags: menu, category, post tag, tag, posts, dynamic, automatic, custom, taxonomy, custom taxonomy
Requires at least: 3.2.1
Tested up to: 4.2.2
Stable tag: 1.2.0

Dynamic menus: This plugin automatically replaces selected Category / Post Tag / Custom Taxonomy links in a Custom Menu by a list of their posts/pages.

== Description ==

The custom menu only allows adding a link that leads to a list of posts and pages belonging to a taxonomy (category, tag or custom). I wanted to insert the posts and pages <b>themselves</b> into the menu, so I wrote this plug-in. If you want to list the posts and pages belonging to a certain taxonomy in the menu and if you want Wordpress to do this automatically for you, then I hope you will find this plugin useful.

<strong>Also works for custom post taxonomies and custom post types!</strong>

= Using it =
Enable the plugin and go to Appearance > Menus. Create your Custom Menu. Add a taxonomy (category/tag/custom) to the menu. Next, you can choose if you would like to replace the original link (to a page that lists the items) by the posts and pages themselves.

For each Category or Post Tag item in the menu, you now have the following extra configuration options: 

* replace the link by a list of posts in the menu y/n; 
* specify the (maximum) number of posts you want to show for this item (-1 = all, 0 also allowed now);
* their ordering ascending or descending by ID, Author, Title and other properties. See 'Other Notes > Ordering';
* keep or remove the original menu item (always / only if there are no posts / never);
* specify the title for the menu items. For this you can use %post_title, %post_author and other wildcards, see 'Other Notes > Wildcards'.

= Details =
This plugin uses the wp_nav_menu_objects filter hook to remove and replace category items in the menu by the posts in that category. It extends Walker_Nav_Menu_Edit to add input fields to Appearance > Menus and adds some CSS to style this properly.

The plugin now supports the wp_nav_menu_item_custom_fields hook and should be compatible with other plugins that also use this hook.

== Wildcards ==

You can control the title of the menu items generated by the plug-in with the following wildcards:

* %post_title
* %post_author
* %post_featured_image_url
* %post_featured_image (insers an HTML 'img' tag with the featured image or nothing if there is none)
* %post_featured_image_thumb_url
* %post_featured_image_thumb (insers an HTML 'img' tag with the featured image thumbnail or nothing if there is none)
* %post_excerpt
* %post_url
* %post_date for the unformatted post date: 2012-11-10 18:14:23
* %post_date() for a formatted post date with the following default formatting: November 10th, 2012
* %post_date(&lt;your formatting here&gt;) for custom date formatting. Example: %post_date(l jS \of F Y, h:i:s A). See <a href="http://codex.wordpress.org/Formatting_Date_and_Time">http://codex.wordpress.org/Formatting_Date_and_Time</a> for formatting options.
* %post_date_gmt
* %post_date_gmt()
* %post_date_gmt(&lt;your formatting here&gt;)
* %post_status
* %post_modified
* %post_modified()
* %post_modified(&lt;your formatting here&gt;)
* %post_modified_gmt
* %post_modified_gmt()
* %post_modified_gmt(&lt;your formatting here&gt;)
* %post_comment_count
* wildcards for custom fields, like %post_my_field, where 'my field' or 'my_field' is a custom field

The following wildcards are deprecated:

* %post_feat_image (url only)
* %post_feat_image_thumb (url only)

== Ordering ==

You can control the ordering of the items in the menu by sorting ascending or descending on the following properties:

* None
* ID
* Author
* Title
* Date
* Last Modified
* Post/Page parent ID
* Random Order
* Number of Comments
* Menu Order - Ordering by menu order is only possible for hierarchical types, such as pages. These have the 'Order' option when editing, this is the menu order.

== Screenshots ==

1. Go to Appearance > Menu to enable/disable and set the options for the replacement of Category / Post Tag links by their posts.

== Changelog ==

1.2

* Fixed serious bug in versioning, which resulted in version 1.1 having no settings at all anymore. This fix has been tested with both both the upgrade path 1.0.1 -> 1.2 and upgrade path 1.0.1 -> 1.1 -> 1.2, both upgrade paths should be fined now. My sincere apologies to all who experienced this issue.
* Fixed debug errors as reported here https://wordpress.org/support/topic/undefined-index-56?replies=7

1.1

* Process custom fields last, so that users cannot override the built-in options like %post_featured_image with a custom field named "featured_image". As reported here https://wordpress.org/support/topic/category-lastes-post-with-images?replies=7#post-7052239
* Allow others to extend my CPCM plugin with their own fields. Also includes a sample that shows how to do this. https://wordpress.org/support/topic/exclude-single-posts?replies=5
* Some comments and code formatting
* Introduced plugin versioning in code in order to perform data conversion 
* Converted "cpcm-" custom fields to "_cpcm-" so that they don't show on post edit pages and the like.
* Update contact information
* Ensure that excluding subcategories now also works for custom taxonomies. Only show the dropdown for hierarchical taxonomies. (Tags no longer show 'Subcategory posts' dropdown.)
* Add custom CSS classes, as suggested here https://wordpress.org/support/topic/adding-css-classes-to-the-newly-displayed-menu-items

1.0.1

* Added hook wp_nav_menu_item_custom_fields for compatibility with other plug-ins adding fields to the Appearances > Menus page.
* Fix for CSS class bugs reported by brangelo in https://wordpress.org/support/topic/works-with-41-as-far-as-i-can-tell?replies=5.
* Bugfix: normal menu items that were below a menu item removed by cpcm, are now repositioned in the menu correctly.
* Bugfix for subcategories with a single post with setting remove="only if empty": "For example, I have a parent category A with sub categories A1, A2 and A3. I have all sub categories set to remove only if there are no posts. Subcat A1 displays with submenu of posts (2), subcats A2 and A3 do not display and their posts (1 each) show directly under the parent as posts links."

1.0

* Bugfix: Correctly set the menu item parents. Relevant when nesting categories with 'Create submenu' checked.
* First implementation (WIP) for request: http://wordpress.org/support/topic/replace-category-link-with-link-to-first-post?replies=10
When the menu item is marked as remove "always" or "only if empty" and there was one post, then make sure that any childen of the menu item become children of this single post.
* Implement skip-parameter
* Implemented exclusion of subcategories, useful alternative to http://wordpress.org/support/topic/is-it-possible-to-get-sub-category-post-nested

0.9.5

* Fixed http://wordpress.org/support/topic/great-job-please-contact-me?replies=2. You can now specify 0 in 'Number of posts'. That way, the category can be shown/hidden based on whether it is empty or not.
* Fixed http://wordpress.org/support/topic/post_date. Forward slash is now accepted in date formatting.

0.9.4

* Fix http://wordpress.org/support/topic/date-fields-for-menu-title-dont-work due to variable $string that has been moved out of the global scope in new Wordpress release.

0.9.3

* Fix http://wordpress.org/support/topic/issue-with-default-wordpress-sidebar-menu
* Fix http://wordpress.org/support/topic/menu-do-not-include-the-current-menu-parent-class
* Add support for auto-generated image tags, see http://wordpress.org/support/topic/images-showing-url-instead-of-actual-image

0.9.2

* Fixed bug introduced in 0.9.1 with respect to old PHP versions (5.2 and before) http://wordpress.org/support/topic/unexpected-t_function-1
* Introduced an extra ordering option 'Menu Order', as suggested here: http://wordpress.org/support/topic/extend-orderby-to-menu_order

0.9.1

* Edits for strict mode (http://wordpress.org/support/topic/edits-for-strict-mode)
* Add thumbnail option with posts (http://wordpress.org/support/topic/add-thumbnail-option-with-posts)
* PHP 5.5 preg_replace() /e modifier deprecated (http://wordpress.org/support/topic/php-55-preg_replace-e-modifier-depricated)

0.9

* Fixed CSS 'active' class problem: CSS classes are no longer copied from the parent menu item to the menu item for the posts/pages.

0.8

* Added the option to keep or remove the original menu item. Initially, the original menu item was replaced by the list of its posts, but now you can choose for yourself whether this should be done (always / only if there are no posts / never)

0.7.2

* Bugfix: Fixed invalid argument error reported by macrocurio in Plugin Support.

0.7.1

* Bugfix: Link Target, CSS Classes, Link Relationship (XFN) and Description weren't inherited from the original menu item. They are now.

0.7

* Added support for custom post types
* Fixed user_data bug
* Added date formatting options

0.6

* Added a bunch of wildcards: %post_feat_image (url only), %post_excerpt, %post_url, %post_date, %post_date_gmt, %post_status, %post_modified, %post_modified_gmt, %post_comment_count

0.5

* Enable custom taxonomies.
* Change plugin URL.

0.4

* Fix plugin bug for Tags, probably related to 3.2.2 update.
* Edit documentation
* Change some CSS to show checkbox next to label instead of above it.
* Edit text in menu item block to clarify use of custom fields.

0.3

* Extended the plugin for use of custom fields. Use a custom field with name 'my field' with wildcard %post_my_field. Note that if the post does not have this custom field, the wildcard is removed (it is not replaced by anything).

0.2

* Extended the plugin to post tags. Note that the plugin name has unfortunately _not_ been changed to reflect this extension. 

Added checkboxes, dropdowns and text fields to Appearance > Menu. It is now possible to:

* Enable/disable per taxonomy item whether you want to replace it by its posts
* Specify the (maximum) number of posts that should be displayed.
* Specify the ordering (Descending/Ascending) and the field to order by (ID, title, etc..)
* Set a title for the menu items. For this you can use the wildcards %post_title and %post_author.

== Installation ==

1. Upload `category-posts-in-custom-menu.php` to the `/wp-content/plugins/` directory
2. Activate the plugin through the 'Plugins' menu in WordPress

== Frequently Asked Questions ==

= How do I use it?  =

Here's a walkthrough:

<ol>
<li>Enable the Twenty Eleven theme.</li>
<li>Disable all plugins except Category Posts in Custom Menu.</li>
<li>Create a post with title "Post 1" and add a _new_ category "Category A"</li>
<li>Save the post</li>
<li>Go to Appearances > Menus</li>
<li>Click "create a new menu"</li>
<li>Add the category "Category A" by opening "Categories", checking that category and clicking "Add to menu"</li>
<li>Open the menu item and check "Create submenu containing links to posts with this tag."</li>
<li>Do not change anything else about the menu item</li>
<li>Scroll all the way down and check under "Theme Locations" the checkbox "Primary Menu"</li>
<li>Save the menu</li>
</ol>

If you now look at your blog, you will have a menu with only one item: "Category A". If you hover over that item with the mouse, it will open, and a post is displayed titled "Post 1". Add additional posts to Category A and you will see these additional posts in the menu.

= Can't see it working in any way =

Problem: "I can't see what effect it has had. Nothing has changed (not that I can see) in the Appearance > Menu page. Just like before." 

This problem should only occur if:
<ul>
<li>Your Wordpress version is 3.0 or before: Issue 14527 (http://core.trac.wordpress.org/ticket/14527) may be the cause. When adding a menu item but <i>before</i> saving it, you will indeed see none of the promised checkboxes. So be sure to <b>save your menu</b> after you add a Category/Tag to your menu. <i>Then</i> you'll see the added functionality. Please update your Wordpress version to at least 3.0.1.</li>
<li>You're using an old version of Category Posts in Custom Menu (1.0.0 and before). Please update to the latest version of CPCM.</li>
<li>You're using another plugin that has a higher priority than CPCM and does not use the wp_nav_menu_item_custom_fields hook to add its fields to Appearances > Menus. This other plugin overwrites all fields instead, which means CPCM's fields won't show. Verify by disabling all other plugins and check if the CPCM fields now show.</li>
<li>Other theme or plugin conflicts. Please disable all themes and plugins except CPCM; verify that the CPCM fields show; enable other plugins and themes one by one to determine which plugin/theme conflicts with CPCM.<li>
</ul>